<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Silvia Castiglione, Carmela Serio, Giorgia Girardi, Pasquale Raia" />


<title>Testing RRphylo methods overfit</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Testing RRphylo methods overfit</h1>
<h4 class="author">Silvia Castiglione, Carmela Serio, Giorgia Girardi,
Pasquale Raia</h4>



<div id="index" class="section level2">
<h2>Index</h2>
<ol style="list-style-type: decimal">
<li><a href="#basics">overfit- functions basics</a></li>
<li><a href="#overfitRR">overfitRR</a></li>
<li><a href="#overfitSS">overfitSS</a></li>
<li><a href="#overfitST">overfitST</a></li>
<li><a href="#overfitSC">overfitSC</a></li>
<li><a href="#overfitPGLS">overfitPGLS</a></li>
<li><a href="#examples">Guided examples</a></li>
</ol>
</div>
<div id="basics" class="section level2">
<h2>overfit- functions basics</h2>
<p>Methods using a large number of parameters risk being overfit. This
usually translates in poor fitting with data and trees other than the
those originally used. With RRphylo methods this risk is usually very
low. However, the user can assess how robust the results got by applying
<a href="search.shift.html"><code>search.shift</code></a>, <a href="search.trend.html"><code>search.trend</code></a>, <a href="search.conv.html"><code>search.conv</code></a>, or
<code>PGLS_fossil</code> are by running the <code>overfit-</code>
functions. The basic idea of <code>overfit-</code> is using alternative
tree topologies to test for both phylogenetic and sampling uncertainty
at the same time. Such alternative phylogenies can be provided by the
user as a <code>list</code>/<code>multiPhylo</code> object, otherwise
can be generated through <a href="Alternative-trees.html"><code>resampleTree</code></a>. In this
latter case, the original tree and data are subsampled by specifying a
<code>s</code> parameter, that is the proportion of tips to be removed
from the tree, and species positions are shuffled by using the function
<a href="Alternative-trees.html#swapone"><code>swapONE</code></a>. When
generating phylogenies to test the robustness of
<code>search.shift</code>, <code>search.trend</code> at individual
clades, and <code>search.conv</code>, it is advisable to constrain
<code>resampleTree</code> so that it preserves the identity of
clades/groups under testing. This is achieved by providing as
<code>node</code>/<code>categories</code> arguments of
<code>resampleTree</code> the
<code>node</code>/<code>nodes</code>/<code>state</code> arguments in the
main functions. Similarly, using the phylogenetic tree returned by
<code>RRphylo</code> is recommended.</p>
</div>
<div id="overfitRR" class="section level2">
<h2>overfitRR</h2>
<p><code>overfitRR</code> tests the robustness of the robustness of
ancestral state and rate estimates. It takes as input an object
generated by <a href="RRphylo.html"><code>RRphylo</code></a>, a list of
alternative phylogenetic trees, and all the data used to produce it
(besides necessary phenotypic data, any other argument such as
covariate, predictor, and so on, passed to <code>RRphylo</code>). The
output is a <code>RRphyloList</code> object including: the list of
<code>RRphylo</code> per simulation (<code>$RR.list</code>), the
phenotypic estimate at the tree root per simulation
(<code>$root.est</code>), the 95% confidence interval around the
original phenotypic value at the tree root (<code>$rootCI</code>) and
the regression parameters describing the relation between the original
values at internal nodes and the corresponding figure after subsampling
and swapping (<code>$ace.regressions</code>). A regression slope close
to one indicates a better matching between original and subsampled
values, suggesting the estimation is robust to phylogenetic uncertainty
and subsampling.</p>
<p>Since the ancestral state estimation within <code>RRphylo</code> is
unbounded, sometimes altering the tree topology leads to implausible
root estimate (n.b. setting the <code>rootV</code> does not bound the
estimation, it does not solve this problem). In this case it is
advisable to discard such questionable outputs from
<code>$RR.list</code> before running further analyses.</p>
<div id="guided-examples" class="section level3">
<h3>Guided examples</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## overfitRR routine</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># load the RRphylo example dataset including Ornithodirans tree and data</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;DataOrnithodirans&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>DataOrnithodirans<span class="sc">$</span>treedino<span class="ot">-&gt;</span>treedino</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">log</span>(DataOrnithodirans<span class="sc">$</span>massdino)<span class="ot">-&gt;</span>massdino</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>DataOrnithodirans<span class="sc">$</span>statedino<span class="ot">-&gt;</span>statedino</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co"># extract Pterosaurs tree and data</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">extract.clade</span>(treedino,<span class="dv">746</span>)<span class="ot">-&gt;</span>treeptero</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>massdino[<span class="fu">match</span>(treeptero<span class="sc">$</span>tip.label,<span class="fu">names</span>(massdino))]<span class="ot">-&gt;</span>massptero</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>massptero[<span class="fu">match</span>(treeptero<span class="sc">$</span>tip.label,<span class="fu">names</span>(massptero))]<span class="ot">-&gt;</span>massptero</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"># peform RRphylo on body mass</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="fu">RRphylo</span>(<span class="at">tree=</span>treeptero,<span class="at">y=</span>massptero,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>RRptero</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co"># generate a list of subsampled and swapped phylogenies to test</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>tree.list<span class="ot">&lt;-</span><span class="fu">resampleTree</span>(RRptero<span class="sc">$</span>tree,<span class="at">s =</span> <span class="fl">0.25</span>,<span class="at">swap.si =</span> <span class="fl">0.1</span>,<span class="at">swap.si2 =</span> <span class="fl">0.1</span>,<span class="at">nsim=</span><span class="dv">10</span>)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co"># test the robustness of RRphylo</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>ofRRptero<span class="ot">&lt;-</span><span class="fu">overfitRR</span>(<span class="at">RR =</span> RRptero,<span class="at">y=</span>massptero,<span class="at">phylo.list=</span>tree.list,<span class="at">clus=</span>cc)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="do">## overfitRR routine on multiple RRphylo</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co"># load the RRphylo example dataset including Cetaceans tree and data</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;DataCetaceans&quot;</span>)</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>DataCetaceans<span class="sc">$</span>treecet<span class="ot">-&gt;</span>treecet</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>DataCetaceans<span class="sc">$</span>masscet<span class="ot">-&gt;</span>masscet</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>DataCetaceans<span class="sc">$</span>brainmasscet<span class="ot">-&gt;</span>brainmasscet</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>DataCetaceans<span class="sc">$</span>aceMyst<span class="ot">-&gt;</span>aceMyst</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a><span class="co"># cross-reference the phylogenetic tree and body and brain mass data. Remove from</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a><span class="co"># both the tree and vector of body sizes the species whose brain size is missing</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="fu">drop.tip</span>(treecet,treecet<span class="sc">$</span>tip.label[<span class="sc">-</span><span class="fu">match</span>(<span class="fu">names</span>(brainmasscet),treecet<span class="sc">$</span>tip.label)])<span class="ot">-&gt;</span>treecet.multi</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>masscet[<span class="fu">match</span>(treecet.multi<span class="sc">$</span>tip.label,<span class="fu">names</span>(masscet))]<span class="ot">-&gt;</span>masscet.multi</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a><span class="co"># peform RRphylo on the variable (body mass) to be used as additional predictor</span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a><span class="fu">RRphylo</span>(<span class="at">tree=</span>treecet.multi,<span class="at">y=</span>masscet.multi,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>RRmass.multi</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>RRmass.multi<span class="sc">$</span>aces[,<span class="dv">1</span>]<span class="ot">-&gt;</span>acemass.multi</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a><span class="co"># create the predictor vector: retrieve the ancestral character estimates </span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="co"># of body size at internal nodes from the RR object ($aces) and collate them</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="co"># to the vector of species&#39; body sizes to create</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a><span class="fu">c</span>(acemass.multi,masscet.multi)<span class="ot">-&gt;</span>x1.mass</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a><span class="co"># peform RRphylo on brain mass by using body mass as additional predictor</span></span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a><span class="fu">RRphylo</span>(<span class="at">tree=</span>treecet.multi,<span class="at">y=</span>brainmasscet,<span class="at">x1=</span>x1.mass,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>RRmulti</span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a><span class="co"># generate a list of subsampled and swapped phylogenies to test</span></span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>treecet.list<span class="ot">&lt;-</span><span class="fu">resampleTree</span>(RRmulti<span class="sc">$</span>tree,<span class="at">s =</span> <span class="fl">0.25</span>,<span class="at">swap.si=</span><span class="fl">0.1</span>,<span class="at">swap.si2=</span><span class="fl">0.1</span>,<span class="at">nsim=</span><span class="dv">10</span>)</span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a><span class="co"># test the robustness of multiple RRphylo</span></span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a>ofRRcet<span class="ot">&lt;-</span><span class="fu">overfitRR</span>(<span class="at">RR =</span> RRmulti,<span class="at">y=</span>brainmasscet,<span class="at">phylo.list=</span>treecet.list,<span class="at">clus=</span>cc,<span class="at">x1 =</span>x1.mass)</span></code></pre></div>
</div>
</div>
<div id="overfitSS" class="section level2">
<h2>overfitSS</h2>
<p><code>overfitSS</code> tests the robustness of
<code>search.shift</code>. It takes as input an object generated by
<code>RRphylo</code> (<code>RR</code>), an object generated by
<code>overfitRR</code> performed on <code>RR</code>
(<code>oveRR</code>), and <code>node</code> and/or <code>state</code> as
passed to <code>search.shift</code> (they can be provided at the same
time). The output is a <code>RRphyloList</code> object including: the
results of <code>search.shift</code> under clade condition
(<code>$SSclade.list</code>) and sparse condition
(<code>$SSsparse.list</code>) per simulation, and a
<code>$shift.results</code> summary object. The latter element returns
separate results for <a href="search.shift.html#clade"><code>clade</code></a> and <a href="search.shift.html#sparse"><code>sparse</code></a> conditions
(<code>$shift.results</code>). The first (<strong>clade</strong>)
includes the proportion of simulations producing significant and
positive (<strong>p.shift+</strong>) or significant and negative
(<strong>p.shift-</strong>) rate shifts for each single node (either
compared to the rest of the tree -
<strong>$single.clades$singles</strong> - or to the rest of the tree
after removing other shifting clades -
<strong>$single.clades$no.others</strong>), and for all the clades taken
as a whole (<strong>$all.clades.together</strong> - see <a href="search.shift.html#clade"><em>Testing rate shifts pertaining to
entire clades</em></a> for further details). Under the
<code>sparse</code> condition (<strong>sparse</strong>), the same
figures as before are reported for each state category compared to the
rest of the tree and for all possible pair of categories (see <a href="search.shift.html#sparse"><em>Testing rate shifts pertaining to
phylogenetically unrelated species</em></a> for further details).</p>
<div id="guided-examples-1" class="section level3">
<h3>Guided examples</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># load the RRphylo example dataset including Ornithodirans tree and data</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;DataOrnithodirans&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>DataOrnithodirans<span class="sc">$</span>treedino<span class="ot">-&gt;</span>treedino</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">log</span>(DataOrnithodirans<span class="sc">$</span>massdino)<span class="ot">-&gt;</span>massdino</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>DataOrnithodirans<span class="sc">$</span>statedino<span class="ot">-&gt;</span>statedino</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co"># peform RRphylo on Ornithodirans tree and data</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="fu">RRphylo</span>(<span class="at">tree=</span>treedino,<span class="at">y=</span>massdino,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>dinoRates</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># perform search.shift under both &quot;clade&quot; and &quot;sparse&quot; condition</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="fu">search.shift</span>(<span class="at">RR=</span>dinoRates, <span class="at">status.type=</span> <span class="st">&quot;clade&quot;</span>)<span class="ot">-&gt;</span>SSauto</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="fu">search.shift</span>(<span class="at">RR=</span>dinoRates, <span class="at">status.type=</span> <span class="st">&quot;sparse&quot;</span>, <span class="at">state=</span>statedino)<span class="ot">-&gt;</span>SSstate</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="do">## overfitSS routine</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co"># generate a list of subsampled and swapped phylogenies, setting as categories/node</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co"># the state/node under testing</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>tree.list<span class="ot">&lt;-</span><span class="fu">resampleTree</span>(dinoRates<span class="sc">$</span>tree,<span class="at">s =</span> <span class="fl">0.25</span>,<span class="at">categories=</span>statedino,</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="at">node=</span><span class="fu">rownames</span>(SSauto<span class="sc">$</span>single.clades),<span class="at">swap.si =</span> <span class="fl">0.1</span>,<span class="at">swap.si2 =</span> <span class="fl">0.1</span>,<span class="at">nsim=</span><span class="dv">10</span>)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co"># test the robustness of search.shift</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>ofRRdino<span class="ot">&lt;-</span><span class="fu">overfitRR</span>(<span class="at">RR =</span> dinoRates,<span class="at">y=</span>massdino,<span class="at">phylo.list=</span>tree.list,<span class="at">clus=</span>cc)</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>ofSS<span class="ot">&lt;-</span><span class="fu">overfitSS</span>(<span class="at">RR =</span> dinoRates,<span class="at">oveRR =</span> ofRRdino,<span class="at">state=</span>statedino,</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>                <span class="at">node=</span><span class="fu">rownames</span>(SSauto<span class="sc">$</span>single.clades))</span></code></pre></div>
</div>
</div>
<div id="overfitST" class="section level2">
<h2>overfitST</h2>
<p><code>overfitST</code> tests the robustness of
<code>search.trend</code>. It takes as input an object generated by
<code>RRphylo</code> (<code>RR</code>), the phenotypic data
(<code>y</code>), an object generated by <code>overfitRR</code>
performed on <code>RR</code> (<code>oveRR</code>), and the arguments
<code>x1</code>, <code>x1.residuals</code>, <code>node</code>, and
<code>cov</code> as passed to <code>search.trend</code>. The output is a
<code>RRphyloList</code> object including: the results of
<code>search.trend</code> per simulation (<code>$ST.list</code>) and a
<code>$trend.results</code> summary object. Within the latter object,
results for the entire tree (<strong>tree</strong>) summarize the
proportion of simulations producing positive (<strong>slope+</strong>)
or negative (<strong>slope-</strong>) slopes significantly higher
(<strong>p.up</strong>) or lower (<strong>p.down</strong>) than BM
simulations for either phenotypes or rescaled rates versus time
regressions. Such evaluations is based on <strong>p.random</strong> only
(see <a href="search.trend.html#tree"><em>Temporal trends on the entire
tree</em></a>,for further details). When specific clades are under
testing, the same set of results as for the whole tree is returned for
each node (<strong>node</strong>). In this case, for phenotype versus
age regression through nodes, the proportion of significant and
positive/negative slopes
(<strong>slope+p.up</strong>,<strong>slope+p.down</strong>,<strong>slope-p.up</strong>,<strong>slope-p.down</strong>)
is accompanied by the same figures for the estimated marginal mean
differences (<strong>p.emm+</strong> and <strong>p.emm-</strong>). As
for the temporal trend in absolute rates through node, the proportion of
significant and positive/negative estimated marginal means differences
(<strong>p.emm+</strong> and <strong>p.emm-</strong>) and the same
figure for slope difference (<strong>p.slope+</strong> and
<strong>p.slope-</strong>) are reported (see <a href="search.trend.html#nodes"><em>Temporal trends at clade
level</em></a>). Finally when more than one node is tested, the
<code>$trend.results</code> object also includes results for the
pairwise comparison between nodes.</p>
<div id="guided-examples-2" class="section level3">
<h3>Guided examples</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="do">## Case 1</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># load the RRphylo example dataset including Ornithodirans tree and data</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;DataOrnithodirans&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>DataOrnithodirans<span class="sc">$</span>treedino<span class="ot">-&gt;</span>treedino</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="fu">log</span>(DataOrnithodirans<span class="sc">$</span>massdino)<span class="ot">-&gt;</span>massdino</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>DataOrnithodirans<span class="sc">$</span>statedino<span class="ot">-&gt;</span>statedino</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co"># extract Pterosaurs tree and data</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="fu">extract.clade</span>(treedino,<span class="dv">746</span>)<span class="ot">-&gt;</span>treeptero</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>massdino[<span class="fu">match</span>(treeptero<span class="sc">$</span>tip.label,<span class="fu">names</span>(massdino))]<span class="ot">-&gt;</span>massptero</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>massptero[<span class="fu">match</span>(treeptero<span class="sc">$</span>tip.label,<span class="fu">names</span>(massptero))]<span class="ot">-&gt;</span>massptero</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co"># perform RRphylo and search.trend on body mass data</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="fu">RRphylo</span>(<span class="at">tree=</span>treeptero,<span class="at">y=</span>massptero,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>RRptero</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="fu">search.trend</span>(<span class="at">RR=</span>RRptero, <span class="at">y=</span>massptero,<span class="at">node=</span><span class="dv">143</span>,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>ST</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="do">## overfitST routine</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co"># generate a list of subsampled and swapped phylogenies setting as node</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co"># the clade under testing</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>treeptero.list<span class="ot">&lt;-</span><span class="fu">resampleTree</span>(RRptero<span class="sc">$</span>tree,<span class="at">s =</span> <span class="fl">0.25</span>,<span class="at">node=</span><span class="dv">143</span>,</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>                             <span class="at">swap.si =</span> <span class="fl">0.1</span>,<span class="at">swap.si2 =</span> <span class="fl">0.1</span>,<span class="at">nsim=</span><span class="dv">10</span>)</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co"># test the robustness of search.trend</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>ofRRptero<span class="ot">&lt;-</span><span class="fu">overfitRR</span>(<span class="at">RR =</span> RRptero,<span class="at">y=</span>massptero,<span class="at">phylo.list=</span>treeptero.list,<span class="at">clus=</span>cc)</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>ofSTptero<span class="ot">&lt;-</span><span class="fu">overfitST</span>(<span class="at">RR=</span>RRptero,<span class="at">y=</span>massptero,<span class="at">oveRR=</span>ofRRptero,<span class="at">node=</span><span class="dv">143</span>,<span class="at">clus=</span>cc)</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="do">## Case 2</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co"># load the RRphylo example dataset including Cetaceans tree and data</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;DataCetaceans&quot;</span>)</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>DataCetaceans<span class="sc">$</span>treecet<span class="ot">-&gt;</span>treecet</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>DataCetaceans<span class="sc">$</span>masscet<span class="ot">-&gt;</span>masscet</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>DataCetaceans<span class="sc">$</span>brainmasscet<span class="ot">-&gt;</span>brainmasscet</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co"># cross-reference the phylogenetic tree and body and brain mass data. Remove from</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co"># both the tree and vector of body sizes the species whose brain size is missing</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="fu">drop.tip</span>(treecet,treecet<span class="sc">$</span>tip.label[<span class="sc">-</span><span class="fu">match</span>(<span class="fu">names</span>(brainmasscet),</span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>                                               treecet<span class="sc">$</span>tip.label)])<span class="ot">-&gt;</span>treecet.multi</span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>masscet[<span class="fu">match</span>(treecet.multi<span class="sc">$</span>tip.label,<span class="fu">names</span>(masscet))]<span class="ot">-&gt;</span>masscet.multi</span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co"># peform RRphylo on the variable (body mass) to be used as additional predictor</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="fu">RRphylo</span>(<span class="at">tree=</span>treecet.multi,<span class="at">y=</span>masscet.multi,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>RRmass.multi</span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>RRmass.multi<span class="sc">$</span>aces[,<span class="dv">1</span>]<span class="ot">-&gt;</span>acemass.multi</span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co"># create the predictor vector: retrieve the ancestral character estimates </span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="co"># of body size at internal nodes from the RR object ($aces) and collate them</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a><span class="co"># to the vector of species&#39; body sizes to create</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a><span class="fu">c</span>(acemass.multi,masscet.multi)<span class="ot">-&gt;</span>x1.mass</span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a><span class="co"># peform RRphylo and search.trend on brain mass by using body mass as additional predictor</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a><span class="fu">RRphylo</span>(<span class="at">tree=</span>treecet.multi,<span class="at">y=</span>brainmasscet,<span class="at">x1=</span>x1.mass,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>RRmulti</span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a><span class="fu">search.trend</span>(<span class="at">RR=</span>RRmulti, <span class="at">y=</span>brainmasscet,<span class="at">x1=</span>x1.mass,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>STcet</span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a><span class="do">## overfitST routine</span></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a><span class="co"># generate a list of subsampled and swapped phylogenies to test</span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a>treecet.list<span class="ot">&lt;-</span><span class="fu">resampleTree</span>(RRmulti<span class="sc">$</span>tree,<span class="at">s =</span> <span class="fl">0.25</span>,<span class="at">swap.si=</span><span class="fl">0.1</span>,<span class="at">swap.si2=</span><span class="fl">0.1</span>,<span class="at">nsim=</span><span class="dv">10</span>)</span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a><span class="co"># test the robustness of search.trend with and without x1.residuals</span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a>ofRRcet<span class="ot">&lt;-</span><span class="fu">overfitRR</span>(<span class="at">RR =</span> RRmulti,<span class="at">y=</span>brainmasscet,<span class="at">phylo.list=</span>treecet.list,<span class="at">clus=</span>cc,<span class="at">x1 =</span>x1.mass)</span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a>ofSTcet1<span class="ot">&lt;-</span><span class="fu">overfitST</span>(<span class="at">RR=</span>RRmulti,<span class="at">y=</span>brainmasscet,<span class="at">oveRR=</span>ofRRcet,<span class="at">x1 =</span>x1.mass,<span class="at">clus=</span>cc)</span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a>ofSTcet2<span class="ot">&lt;-</span><span class="fu">overfitST</span>(<span class="at">RR=</span>RRmulti,<span class="at">y=</span>brainmasscet,<span class="at">oveRR=</span>ofRRcet,<span class="at">x1 =</span>x1.mass,<span class="at">x1.residuals =</span> <span class="cn">TRUE</span>,<span class="at">clus=</span>cc)</span></code></pre></div>
</div>
</div>
<div id="overfitSC" class="section level2">
<h2>overfitSC</h2>
<p><code>overfitSC</code> is the last step of a short routine the user
should apply to test the robustness of <code>search.conv</code> results
(see the <a href="#examples">examples</a> below).</p>
<ol style="list-style-type: decimal">
<li><p>Generating a number of altered (i.e. subsampled and swapped)
phylogenies by using <code>resampleTree</code>.</p></li>
<li><p>In case the multivariate shape data used as input to
<code>search.conv</code> were reduced (e.g. by SVD), such data must be
matched with each of the subsampled-swapped generated tree and the
resulting dataset must be reduced as well.</p></li>
<li><p>The list of phylogenetic trees and multivariate shape data can be
fed to <code>overfitSC</code> for testing.</p></li>
</ol>
<p>Similarly to <code>overfitRR</code>, <code>overfitSC</code> returns
<code>RRphyloList</code> objects including the outputs of
<code>RRphylo</code> and, depending on the analysis performed, the
outputs of <code>search.conv</code> under <code>clade</code> or
<code>state</code> conditions applied on the modified trees.</p>
<p>Results for robustness of <code>search.conv</code>
(<code>$conv.results</code>) include separate objects for convergence
between <a href="search.conv.html#nodes"><code>clades</code></a> or
between/within <a href="search.conv.html#state"><code>states</code></a>.
Under the first case (<strong>clade</strong>), the proportion of
simulations producing significant instance of convergence
(<strong>p.ang.bydist</strong>) or convergence and parallelism
(<strong>p.ang.conv</strong>) between selected clades are returned (see
<a href="search.conv.html#nodes"><em>Morphological convergence between
clades</em></a> for further details). As for convergence between/within
discrete categories (<strong>state</strong>), <code>overfitRR</code>
returns the proportion of simulations producing significant instance of
convergence either accounting (<strong>p.ang.state.time</strong>) or not
accounting (<strong>p.ang.state</strong>) for the time intervening
between the tips in the focal state <a href="search.conv.html#state"><em>Morphological convergence
within/between categories</em></a> for explanations).</p>
<div id="guided-examples-3" class="section level3">
<h3>Guided examples</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(Morpho)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">## Testing search.conv</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># load the RRphylo example dataset including Felids tree and data</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;DataFelids&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>DataFelids<span class="sc">$</span>treefel<span class="ot">-&gt;</span>treefel</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>DataFelids<span class="sc">$</span>statefel<span class="ot">-&gt;</span>statefel</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>DataFelids<span class="sc">$</span>landfel<span class="ot">-&gt;</span>feldata</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co"># perform data reduction via Procrustes superimposition (in this case)</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="fu">procSym</span>(feldata)<span class="ot">-&gt;</span>pcafel</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>pcafel<span class="sc">$</span>PCscores<span class="ot">-&gt;</span>PCscoresfel</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co"># perform RRphylo on Felids tree and data</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="fu">RRphylo</span>(treefel,PCscoresfel)<span class="ot">-&gt;</span>RRfel</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co"># search for morphologicl convergence between clades (automatic mode) </span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co"># and within the category</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="fu">search.conv</span>(<span class="at">RR=</span>RRfel, <span class="at">y=</span>PCscoresfel, <span class="at">min.dim=</span><span class="dv">5</span>, <span class="at">min.dist=</span><span class="st">&quot;time38&quot;</span>)<span class="ot">-&gt;</span>sc1</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="fu">search.conv</span>(<span class="at">tree=</span>treefel, <span class="at">y=</span>PCscoresfel, <span class="at">state=</span>statefel, <span class="at">declust=</span><span class="cn">TRUE</span>)<span class="ot">-&gt;</span>sc2</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co"># select converging clades returned in sc1</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>felnods<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">85</span>,<span class="dv">155</span>)</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="do">## overfitSC routine</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co"># generate a list of subsampled and swapped phylogenies to test for search.conv</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co"># robustness. Use as reference tree the phylogeny returned by RRphylo.</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co"># Set the nodes and the categories under testing as arguments of</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co"># resampleTree so that it maintains no less than 5 species in each clade/state.</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>tree.list<span class="ot">&lt;-</span><span class="fu">resampleTree</span>(RRfel<span class="sc">$</span>tree,<span class="at">s=</span><span class="fl">0.15</span>,<span class="at">nodes=</span>felnods,<span class="at">categories=</span>statefel,</span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>                        <span class="at">nsim=</span><span class="dv">15</span>,<span class="at">swap.si=</span><span class="fl">0.1</span>,<span class="at">swap.si2=</span><span class="fl">0.1</span>)</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="co"># match the original data with each subsampled-swapped phylogeny in tree.list</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="co"># and repeat data reduction</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>y.list<span class="ot">&lt;-</span><span class="fu">lapply</span>(tree.list,<span class="cf">function</span>(k){</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>  <span class="fu">treedataMatch</span>(k,feldata)[[<span class="dv">1</span>]]<span class="ot">-&gt;</span>ynew</span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>  <span class="fu">procSym</span>(ynew)<span class="sc">$</span>PCscores</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>})</span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a><span class="co"># test for robustness of search.conv results by overfitSC</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>oSC<span class="ot">&lt;-</span><span class="fu">overfitSC</span>(<span class="at">RR=</span>RRfel,<span class="at">phylo.list=</span>tree.list,<span class="at">y.list=</span>y.list,</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>               <span class="at">nodes =</span> felnods,<span class="at">state=</span>statefel)</span></code></pre></div>
</div>
</div>
<div id="overfitPGLS" class="section level2">
<h2>overfitPGLS</h2>
<p><code>overfitPGLS</code> tests the robustness of
<code>PGLS_fossil</code>. Other than the regression formula
(<code>modform</code>), it takes as input an object generated by
<code>overfitRR</code> (if <code>PGLS_fossil</code> should be performed
on trees rescaled according to <code>RRphylo</code> rates) and/or a list
of alternative phylogenies (if no tree rescaling should be performed).
These arguments are not exclusive though, they can be provided at the
same time. The output includes separate objects for the analyses
performed on the original tree (<code>$tree</code>) and on the tree
rescaled according to <code>RRphylo</code> rates (<code>$RR</code>).</p>
</div>
<div id="guided-examples-4" class="section level2">
<h2>Guided examples</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">library</span>(phytools)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># generate fictional data to test the function</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">rtree</span>(<span class="dv">100</span>)<span class="ot">-&gt;</span>tree</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="fu">fastBM</span>(tree)<span class="ot">-&gt;</span>resp</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="fu">fastBM</span>(tree,<span class="at">nsim=</span><span class="dv">3</span>)<span class="ot">-&gt;</span>resp.multi</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="fu">fastBM</span>(tree)<span class="ot">-&gt;</span>pred1</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="fu">fastBM</span>(tree)<span class="ot">-&gt;</span>pred2</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">y1=</span>resp,<span class="at">x2=</span>pred1,<span class="at">x1=</span>pred2)<span class="ot">-&gt;</span>dato</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co"># perform RRphylo and PGLS_fossil with univariate/multivariate phenotypic data</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="fu">PGLS_fossil</span>(<span class="at">modform=</span>y1<span class="sc">~</span>x1<span class="sc">+</span>x2,<span class="at">data=</span>dato,<span class="at">tree=</span>tree)<span class="ot">-&gt;</span>pgls_noRR</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="fu">RRphylo</span>(tree,resp,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>RR</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="fu">PGLS_fossil</span>(<span class="at">modform=</span>resp<span class="sc">~</span>pred1<span class="sc">+</span>pred2,<span class="at">RR=</span>RR)<span class="ot">-&gt;</span>pgls_RR</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="fu">PGLS_fossil</span>(<span class="at">modform=</span>y1<span class="sc">~</span>x1<span class="sc">+</span>x2,<span class="at">data=</span><span class="fu">list</span>(<span class="at">y1=</span>resp.multi,<span class="at">x2=</span>pred1,<span class="at">x1=</span>pred2),<span class="at">tree=</span>tree)<span class="ot">-&gt;</span>pgls2_noRR</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="fu">RRphylo</span>(tree,resp.multi,<span class="at">clus=</span>cc)<span class="ot">-&gt;</span>RR2</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="fu">PGLS_fossil</span>(<span class="at">modform=</span>resp.multi<span class="sc">~</span>pred1<span class="sc">+</span>pred2,<span class="at">tree=</span>tree,<span class="at">RR=</span>RR)<span class="ot">-&gt;</span>pgls2_RR</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="do">## overfitPGLS routine</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co"># generate a list of subsampled and swapped phylogenies to test</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>tree.list<span class="ot">&lt;-</span><span class="fu">resampleTree</span>(RR<span class="sc">$</span>tree,<span class="at">s =</span> <span class="fl">0.25</span>,<span class="at">swap.si=</span><span class="fl">0.1</span>,<span class="at">swap.si2=</span><span class="fl">0.1</span>,<span class="at">nsim=</span><span class="dv">10</span>)</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co"># test the robustnes of PGLS_fossil with univariate/multivariate phenotypic data</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>ofRR<span class="ot">&lt;-</span><span class="fu">overfitRR</span>(<span class="at">RR =</span> RR,<span class="at">y=</span>resp,<span class="at">phylo.list=</span>tree.list,<span class="at">clus=</span>cc)</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>ofPGLS<span class="ot">&lt;-</span><span class="fu">overfitPGLS</span>(<span class="at">oveRR =</span> ofRR,<span class="at">phylo.list=</span>tree.list,<span class="at">modform =</span> y1<span class="sc">~</span>x1<span class="sc">+</span>x2,<span class="at">data=</span>dato)</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>ofRR2<span class="ot">&lt;-</span><span class="fu">overfitRR</span>(<span class="at">RR =</span> RR2,<span class="at">y=</span>resp.multi,<span class="at">phylo.list=</span>tree.list,<span class="at">clus=</span>cc)</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>ofPGLS2<span class="ot">&lt;-</span><span class="fu">overfitPGLS</span>(<span class="at">oveRR =</span> ofRR2,<span class="at">phylo.list=</span>tree.list,<span class="at">modform =</span> y1<span class="sc">~</span>x1<span class="sc">+</span>x2,</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>                     <span class="at">data=</span><span class="fu">list</span>(<span class="at">y1=</span>resp.multi,<span class="at">x2=</span>pred1,<span class="at">x1=</span>pred2))</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
